version: 2.1

jobs:
  persist:
    parameters:
      parallel:
        type: integer
      filesize_mb:
        type: integer
    docker:
      - image: cimg/base:current
    resource_class: xlarge
    parallelism: << parameters.parallel >>
    steps:
      - run:
          name: Generate file of << parameters.filesize_mb >> MB
          command: |
            head -c $((<< parameters.filesize_mb >>*1048576)) /dev/urandom > sample.txt

            ls -lah sample.txt
      - persist_to_workspace:
          root: .
          paths:
            - sample.txt

workflows:
  file_already_closed:
    jobs:
      - persist:
          matrix:
            parameters:
              parallel:
                - 3
              filesize_mb:
                # NOTE: 5 GB = 5120 MB
                # ---
                # 4.5 GB passed
                # 4.75 GB passed
                # 4.875 GB passed
                # ---
                # 4.9 GB
                - 5018
                # 4.95 GB
                - 5068
                # 4.99 GB
                - 5110
